package app.IM;import net.cellcloud.core.Cellet;import net.cellcloud.talk.dialect.ActionDelegate;import net.cellcloud.talk.dialect.ActionDialect;import org.json.JSONException;import org.json.JSONObject;//import app.IM.GraphMeta;import app.IM.SessionManager;public class Dispatcher {	public final static String REGISTER = "register";	public final static String SHARE_META = "shareMeta";	private Cellet cellet;	public Dispatcher(Cellet cellet) {		this.cellet = cellet;	}	public void dispatch(ActionDialect dialect) {		String action = dialect.getAction();				if (action.equals(SHARE_META)) {			System.out.println("share_meta im");			// 分享 Meta 数据			dialect.act(new ActionDelegate() {				@Override				public void doAction(ActionDialect dialect) {					try {						String stringData = dialect.getParamAsString("data");						JSONObject data = new JSONObject(stringData);						String myName = data.getString("myName");						String peerName = data.getString("peerName");						// 解析 Meta						JSONObject metaJson = data.getJSONObject("meta");						String tag = SessionManager.getInstance().getTagByName(peerName);						if (null != tag) {							ActionDialect ad = new ActionDialect();							ad.setAction(SHARE_META);							JSONObject value = new JSONObject();							value.put("from", myName);							value.put("meta", metaJson);							ad.appendParam("data", value.toString());							// 发送数据							cellet.talk(tag, dialect);						}					} catch (JSONException e) {						e.printStackTrace();					}				}			});		}else if (action.equals(REGISTER)) {			// 注册用户						System.out.println("register im");			try {				String stringData = dialect.getParamAsString("data");				JSONObject data = new JSONObject(stringData);				String name = data.getString("name");				SessionManager.getInstance().register(name.toString(), dialect.getOwnerTag().toString());			} catch (JSONException e) {				e.printStackTrace();			}		}		else {			// Nothing		}	}//	protected GraphMeta parse(JSONObject data) {//		GraphMeta meta = null;//		return meta;//	}}